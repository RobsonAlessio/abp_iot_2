<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>ABP Iot 2 - Mauricio e Robson</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/css/materialize.min.css">
<!--<link rel="stylesheet" type="text/css" href="style.css" media="screen" />-->
    <style>
      body{
          background-color: #E0E0E0;
      }
      nav {
          background-color: #27cc06;
      }
      .content {
          margin-top: 30px;
      }
      .statistic {
          font-size: 4em;
          margin-top: 10px ;
      }
      .card {
          min-height: 250px;
      }
      .card-image {
          text-align: left;
          padding-left: 10%;
      }
      .activator{
          background-color: silver;
          font-family: "Roboto";
          font-size: 2em;
          text-align: center;
      }
      .sensors{
          text-align: left;
          font-size: 2em;
          margin-left: 2px ;
          margin-right: 10px ;
      }
      .titulo{
          font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="navbar-fixed">
      <nav class="nav-extended">
    <!--<div class="nav-content left">
          <img src="https://www1.satc.edu.br/portais/acesso/public/assets/img/logoSatc.png"> 
        </div> -->
        <div class="nav-wrapper"> 
          <a class="brand-logo center">ABP IoT II</a>
        </div>
        <div class="nav-content center">
          <h6>Dupla: Maurício e Robson</h6>
        </div>
      </nav>
    </div>
    <div class="container content">
      <br/>
      <div class="row">
        <div class="col s12 m6">
          <div class="card">
            <div class="card-content activator">
              <i class="material-icons">computer</i>
              <span class="titulo"> Sensores Maurício </span>
            </div>
            <div class="card-image center">
              <i class="material-icons">location_on</i>
              <span class=" sensors "> Distância:  </span>
              <span id="distanciaMauricio" class="statistic">-</span>
            </div>
            <div class="card-image center">
              <i class="material-icons">lightbulb_outline</i>
              <span class=" sensors "> Luminosidade:  </span>
              <span id="luminosidadeMauricio" class="statistic">-</span>
            </div>
            
          </div>
        </div>
        <div class="col s12 m6">
          <div class="card">
            <div class="card-content activator">
              <i class="material-icons">computer</i>
              <span class="titulo "> Sensores Robson </span>
            </div>
            <div class="card-image center">
              <i class="material-icons">location_on</i>
              <span class=" sensors "> Distância:  </span>
              <span id="distanciaRob" class="statistic">-</span>
            </div>
            <div class="card-image center">
              <i class="material-icons">lightbulb_outline</i>
              <span class=" sensors "> Luminosidade:  </span>
              <span id="luminosidadeRob" class="statistic">-</span>
            </div>          
          </div>
        </div>
      </div>
    </div>
  </body>
  <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/js/materialize.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>
  <script src="app.js"></script>
  <script>
    var admin = require("firebase-admin");
    var serviceAccount = require("path/to/serviceAccountKey.json");

    admin.initializeApp({
      credential: admin.credential.cert(serviceAccount),
      databaseURL: "https://abp-iot-2-mauricio-robson-default-rtdb.firebaseio.com"
    });

    (function(){
        
      // Inicia o Firebase
      var config = {
        apiKey: "J8OtwuqbzP6yJzlaXwCxp2MFRNiSkulSFx59UhQn",
        authDomain: "abp-iot-2.com",
        databaseURL: "https://abp-iot-2-mauricio-robson-default-rtdb.firebaseio.com/",
        storageBucket: "sensoriamento-iot-bootcamp.appspot.com",
        messagingSenderId: "1055433905603"
      };
      
      firebase.initializeApp(config);

      var db = firebase.database();

      // Cria os listeners dos dados no firebase
      var distRob = db.ref('distanciaRob');
      var lumiRob = db.ref('luminosidadeRob');
      var distMauricio = db.ref('distanciaMauricio');
      var lumiMauricio = db.ref('luminosidadeMauricio');

      // Registra as funções que atualizam os gráficos e dados atuais da telemetria
      distRob.on('value',function (snapshot) {
        document.getElementById("distanciaRob").innerText = parseFloat(snapshot.val().toFixed(2)) + ' m';
      });
      lumiRob.on('value',function (snapshot) {
        document.getElementById("luminosidadeRob").innerText = snapshot.val();
      });
      distMauricio.on('value',function (snapshot) {
        document.getElementById("distanciaMauricio").innerText = parseFloat(snapshot.val().toFixed(2)) + ' m';
      });
      lumiMauricio.on('value',function (snapshot) {
        document.getElementById("luminosidadeMauricio").innerText = snapshot.val();
      });

    })();
  </script>
</html>
